{
  "title": "Rebellis \u2013 API & Services Overview",
  "schemaVersion": 36,
  "version": 1,
  "refresh": "30s",
  "panels": [
    {
      "type": "row",
      "title": "API Overview",
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      }
    },
    {
      "type": "stat",
      "title": "API RPS",
      "targets": [
        {
          "expr": "sum(rate(http_requests_total{job=\"api\"}[5m]))",
          "refId": "A",
          "datasource": {
            "type": "prometheus",
            "uid": "Prometheus"
          }
        }
      ],
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 0,
        "y": 1
      }
    },
    {
      "type": "stat",
      "title": "API 5xx rate (%)",
      "targets": [
        {
          "expr": "100 * (sum(rate(http_requests_total{job=\"api\",status=~\"5..\"}[5m])) / sum(rate(http_requests_total{job=\"api\"}[5m])))",
          "refId": "A",
          "datasource": {
            "type": "prometheus",
            "uid": "Prometheus"
          }
        }
      ],
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 6,
        "y": 1
      }
    },
    {
      "type": "stat",
      "title": "P95 latency (ms)",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{job=\"api\"}[5m])) by (le)) * 1000",
          "refId": "A",
          "datasource": {
            "type": "prometheus",
            "uid": "Prometheus"
          }
        }
      ],
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 12,
        "y": 1
      }
    },
    {
      "type": "graph",
      "title": "API Requests by Status",
      "targets": [
        {
          "expr": "sum by (status) (rate(http_requests_total{job=\"api\"}[5m]))",
          "refId": "A",
          "legendFormat": "{{status}}",
          "datasource": {
            "type": "prometheus",
            "uid": "Prometheus"
          }
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 5
      }
    },
    {
      "type": "row",
      "title": "Services (Whisper & Motion)",
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 13
      }
    },
    {
      "type": "graph",
      "title": "Whisper Pod CPU (cores)",
      "targets": [
        {
          "expr": "sum by (pod) (rate(container_cpu_usage_seconds_total{pod=~\".*-whisper-.*\"}[5m]))",
          "refId": "A",
          "datasource": {
            "type": "prometheus",
            "uid": "Prometheus"
          }
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 14
      }
    },
    {
      "type": "graph",
      "title": "Motion Pod CPU (cores)",
      "targets": [
        {
          "expr": "sum by (pod) (rate(container_cpu_usage_seconds_total{pod=~\".*-motion-.*\"}[5m]))",
          "refId": "A",
          "datasource": {
            "type": "prometheus",
            "uid": "Prometheus"
          }
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 14
      }
    }
  ]
}